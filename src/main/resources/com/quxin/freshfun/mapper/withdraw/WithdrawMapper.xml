<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.quxin.freshfun.dao.WithdrawMapper">

    <!--分页查询提现记录-->
    <select id="selectWithdrawListByAppId" resultType="com.quxin.freshfun.model.withdraw.WithdrawPOJO">
         select id as withdrawId , app_id as appId , user_id as userId , account_type as accountType ,
             account_num as accountNum , withdraw_money as withdrawMoney , state , handler_id as handlerId ,
             remark , created , updated ,is_deleted as isDeleted
         from withdraw_base
         where app_id = #{appId} and is_deleted = 0 order by created desc
         limit #{start} , #{pageSize}
    </select>

    <!--查询正在提现中的总金额-->
    <select id="selectSumWithdrawingByAppId" parameterType="java.lang.Long" resultType="java.lang.Integer">
        select sum(withdraw_money) from withdraw_base
        where app_id = #{appId} and is_deleted = 0 and state = 0
    </select>

    <!--插入提现记录-->
    <insert id="insertWithdraw" parameterType="com.quxin.freshfun.model.withdraw.WithdrawPOJO" useGeneratedKeys="true" keyProperty="withdrawId">
        insert into withdraw_base(app_id , user_id , account_type , account_num , withdraw_money , state , created , updated , is_deleted)
        values(#{appId} , #{userId} , #{accountType} ,#{accountNum} ,#{withdrawMoney} ,#{state} ,#{created},#{updated},#{isDeleted})
    </insert>

    <!---->
    <select id="selectCountWithdrawByAppId" parameterType="Long" resultType="Integer" >
        select count(id) from withdraw_base
        where app_id = #{appId} and is_deleted = 0
    </select>

</mapper>